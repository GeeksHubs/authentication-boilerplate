var d=Object.defineProperty,C=Object.defineProperties,N=Object.getOwnPropertyDescriptor,v=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var H=(r,e,t)=>e in r?d(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,w=(r,e)=>{for(var t in e||(e={}))b.call(e,t)&&H(r,t,e[t]);if(k)for(var t of k(e))j.call(e,t)&&H(r,t,e[t]);return r},y=(r,e)=>C(r,v(e)),B=r=>d(r,"__esModule",{value:!0});var P=(r,e)=>{for(var t in e)d(r,t,{get:e[t],enumerable:!0})},L=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of M(e))!b.call(r,o)&&(t||o!=="default")&&d(r,o,{get:()=>e[o],enumerable:!(n=N(e,o))||n.enumerable});return r};var q=(r=>(e,t)=>r&&r.get(e)||(t=L(B({}),e,1),r&&r.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var I=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var s=(r,e,t)=>(I(r,e,"read from private field"),t?t.call(r):e.get(r)),R=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},x=(r,e,t,n)=>(I(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var m=(r,e,t)=>new Promise((n,o)=>{var u=c=>{try{A(t.next(c))}catch(h){o(h)}},O=c=>{try{A(t.throw(c))}catch(h){o(h)}},A=c=>c.done?n(c.value):Promise.resolve(c.value).then(u,O);A((t=t.apply(r,e)).next())});var z={};P(z,{Hook:()=>T,HookCancel:()=>a,LastOutHook:()=>p,SeriesHook:()=>f,WaterfallHook:()=>l});var a=Symbol("cancel hook run");var i,g,T=class{constructor(e){this.bailOut=e;R(this,i,void 0);R(this,g,void 0);this.id=this.constructor.name,x(this,i,[]),x(this,g,[])}get interceptors(){return s(this,g)}get items(){return s(this,i)}hasHook(e){return s(this,i).some(t=>t.id===e)}addHook(e,t,n){let o=y(w({},n),{id:e,action:t});if(o.before){let u=Math.min(...this.getIndices(o.before));if(u>=0){s(this,i).splice(u,0,o);return}}if(o.after){let u=Math.max(...this.getIndices(o.after));if(u>=0){s(this,i).splice(u+1,0,o);return}}s(this,i).push(o)}addObjHook(e,...t){for(let n of t){let o=e(n);this.addHook(n.id,(...u)=>o.call(n,...u),n)}}getIndices(e){return e.map(t=>s(this,i).findIndex(n=>n.id===t)).filter(t=>t>=0)}removeHook(e){let t=s(this,i).findIndex(n=>n.id===e);return t>=0?(s(this,i).splice(t,1),!0):!1}addInterceptor(e){s(this,g).push(e)}removeInterceptor(e){let t=s(this,g).indexOf(e);return t>=0?(s(this,g).splice(t,1),!0):!1}trigger(...e){return m(this,null,function*(){let t=[],n={index:0,length:s(this,i).length,arg:e[0],args:e};if((yield this.intercept(o=>o.beforeLoop,n))===!1)return a;for(;n.index<n.length;){if(n.hookItem=s(this,i)[n.index],(yield this.intercept(u=>u.beforeTrigger,n))===!1)return a;let o=yield n.hookItem.action(...n.args);if(o===a)return a;if(this.bailOut&&this.bailOut(o))return t.push(o),this.getMergedResults(t,n.args);if(t.push(o),n.args=this.getNextArgs(o,n.args),(yield this.intercept(u=>u.afterTrigger,n))===!1)return a;n.index++}return(yield this.intercept(o=>o.afterLoop,n))===!1?a:this.getMergedResults(t,n.args)})}intercept(e,t){return m(this,null,function*(){for(let n of s(this,g)){let o=e(n);if(o&&!(yield o.apply(n,[t])))return!1}return!0})}merge(e){let t=this.initNew();return s(t,i).push(...s(this,i)),s(t,i).push(...s(e,i)),s(t,g).push(...s(this,g)),s(t,g).push(...s(e,g)),t}};i=new WeakMap,g=new WeakMap;var p=class extends T{constructor(e){super(e)}getNextArgs(e,t){return t}getMergedResults(e){return e.pop()}initNew(){return new p(this.bailOut)}};var f=class extends T{constructor(e){super(e)}getNextArgs(e,t){return t}getMergedResults(e){return e}initNew(){return new f(this.bailOut)}};var l=class extends T{constructor(e){super(e)}getNextArgs(e,t){return t[0]=e,t}getMergedResults(e,t){return e.pop()||t[0]}initNew(){return new l(this.bailOut)}};module.exports=q(z);0&&(module.exports={Hook,HookCancel,LastOutHook,SeriesHook,WaterfallHook});
//# sourceMappingURL=index.js.map
